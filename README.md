## project5. 신규 광고 매체 추천 시스템
> **신규 광고 특성만으로 최적 매체를 추천하고, 예상 전환율·클릭수·수익을 예측하는 데이터 기반 의사결정 지원 서비스**

---
### 📌 프로젝트 개요
신규 광고는 과거 집행 데이터가 없어 매체 선택이 어렵다.<br>
본 프로젝트는 **광고 특성 기반 매체 추천 모델**과 **성과 예측 모델**을 구축하고,  
이를 **Streamlit + Tableau 대시보드 형태로 시각화·서비스화**하였다.

<br>

---
### 🎯 문제 정의
- 신규 광고는 과거 데이터 부재로 **매체 선택이 경험과 직관에 의존**
- 이로 인한 **예산 낭비 및 성과 저하** 발생
- 따라서, 광고 기본 정보만으로 **성과가 기대되는 매체를 자동 추천**하는 모델을 개발

<br>

--- 
### 🧭 전체 프로세스 요약
1. 광고 목록 데이터(`df_list_v1`) 전처리 및 **도메인 자동 분류**  
2. 1년치 광고 로그(`df_rpt_clean`) 정제 및 **성과 집계**  
3. **매체·광고·도메인 교차 피처** 및 통계 피처 생성  
4. **LightGBM 회귀 모델**로 전환율(CVR) 예측  
5. **LambdaMART (LGBMRanker)** 기반 매체 순위 산출  
6. **Hit@K / NDCG@K**로 랭킹 성능 평가  
7. **Streamlit + Tableau 대시보드**로 결과 시각화
<br>

---
### 💾 데이터 구성
| 데이터 | 설명 |
| --- | --- |
| `df_list_v1.csv` | 광고 기본 정보 (도메인, 단계, OS 유형, 기간 등) |
| `df_rpt_clean.csv` | 광고별·매체별 일 단위 성과 로그 (클릭수, 전환수, 비용 등) |
<br>

---
### 🧹 데이터 전처리 & 피처 엔지니어링
#### 1️⃣ 광고 목록 데이터(df_list_v1)
- 제휴사 광고 및 테스트 광고 제거
- `ads_name`, `ads_summary`에서 키워드 기반 **도메인 자동 분류**
<br> → 금융/보험, 게임, 상품소비, 생활서비스, 플랫폼, SNS, 콘텐츠, 앱테크, 유틸리티, 지역/상점 등
- 광고 속성 변수 재정의
  | 변수 | 설명 |
  | --- | --- |
  | `ads_3step` | 광고 단계 (노출 → 참여 → 구매) |
  | `ads_os_type` | OS 구분 (WEB=1, APP=0) |
  | `ads_payment` | 결제 금액 문자열(‘천’, ‘만’) → 숫자형 변환 |
  | `ads_length` | 광고 문안 길이 |
  | `age_limit`, `gender_limit` | 타깃 제한 여부 (이진 변수화) |
<br>

#### 2️⃣ 1년치 성과 로그 데이터 (df_rpt_clean)
- 클릭수 < 전환수인 비정상 데이터 제거
- 시간별 로그를 일자별 광고-매체 단위로 집계
- **추가 피처 생성**
  | 구분 | 예시 | 설명 |
  | --- | --- | --- |
  | 매체별 평균 | `mda_mean_acost`, `mda_mean_earn`,<br> `mda_mean_clk`, `mda_mean_turn` | 매체 평균 누적 성과 |
  | 비용 비율 | `mda_cost_ratio` | 매체별 누적 광고 비율 |
  | 시간 피처 | `month`, `quarter`, `is_month_start`, `is_month_end`, `is_weekday_holiday` | 시점별 패턴 반영 |
<br>

#### 3️⃣ 병합 및 피처 엔지니어링
- ads_idx` 기준으로 광고 목록 + 성과 로그 병합
- 희소조합(`domain`, `ads_3step`, `mda_idx`, `ads_os_type`)은 count < 5인 경우 NaN 처리
- 날짜별 데이터 주차별로 그룹화
- **조합별 통계 피처 생성**
  - `acost_mean`, `earn_mean`, `turn_per_day`, `cvr`
  - domain, OS, 단계, 매체 조합별로 **누적 평균 및 첫 등장 플래그(`is_first_...`)** 생성
- **교차 피처 생성**
  - `domain_ads3step`, `domain_mda`, `ads3step_mda`, `domain_os`, `ads3step_os`, `mda_os`

<br>

---
### 🧠 모델링
#### 1️⃣ 전환율 예측 (LightGBM Regressor)
- 목표 : 주차별 `week_cvr` 예측
- 카테고리형 변수 : `domain`, `ads_os_type`, `mda_idx`, `ads_3step` 등
- 평가 지표 : **R², MAE, RMSE**
- 예측 시각화 : Actual vs Predicted / Residual Plot

- 모델 성능
  | 구분 | R² | MAE | RMSE |
  |------|----|-----|------|
  | Train | 0.7566 | 0.0544 | 0.1195 |
  | Valid | 0.6327 | 0.0626 | 0.1392 |
  | Test | 0.5055 | 0.1662 | 0.2409 |

- train + valid 재학습 후 성능
  | 구분 | R² | MAE | RMSE |
  |------|----|-----|------|
  | Train + Valid | 0.7455 | 0.0533 | 0.1208 |
  | Test | 0.4679 | 0.1735 | 0.2499 |

> 성능이 낮아 보이는 것은 test가 1주차 광고(콜드 스타트)만 포함되어있기 때문 <br>실제로 이 모델은 신규 광고를 대상으로 진행하기 위해 만든 모델 <br>신규 광고는 알려진 정보가 없다보니 예측 자체가 어려운 영역이라 성능이 낮아보이는 것 <br>지금은 1년치 데이터라 표본이 적어서 성능이 불안정해 보이지만 <br>모델을 지속적으로 사용하면서 데이터가 쌓이면 성능이 안정될 뿐 아니라 <br>학습 성능이 개선될 것이라 기대한다.

<br>

#### 2️⃣ 매체 순위 예측 (LGBMRanker, LambdaMART)
- 그룹: `domain_ads3step_os` (도메인+광고단계+OS)
- Objective: `lambdarank`
- Optuna 200회 탐색으로 하이퍼파라미터 최적화  

- 전체 모델 성능
  | Metric | @1 | @3 | @5 | @10 |
  |---------|----|----|----|----|
  | **Hit@K** | 0.1538 | 0.2564 | 0.3692 | 0.4538 |
  | **NDCG@K** | 0.5476 | 0.5295 | 0.5810 | 0.6020 |

- 광고 단위 모델 성능
  | Metric | @1 | @3 | @5 | @10 |
  |---------|----|----|----|----|
  | **Hit@K** | 0.3077 | 0.3846 | 0.6154 | 0.6154 |
  | **NDCG@K** | 0.5558 | 0.5443 | 0.5941 | 0.6148 | 

<br> 

---
### 📊 모델 성과 요약
- 신규 광고 1주차 기준 **61.5% 광고가 성과 개선**  
- 추천 정확도 **Hit@10 0.00 → 0.6154**  
- 실무 적용 시 **매체 선택 효율화** 및 **예산 절감 효과 기대**

<br>

---
### 💡 서비스 구성 (Streamlit)
> `new_add.py` 실행 시 인터랙티브 대시보드 구동

- 기능 요약
  1. 광고 기본 정보 입력 (도메인, 단계, OS, 예산 등)
  2. 추천 매체 탭 - 매체별 추천 순위, 예측 점수(0~1), 전환율, 클릭수, 수익 등 제공
  3. 매체 상세 분석 탭 - 입력 광고와 유사한 광고군의 누적 성과 비교
  4. 전체 매체 성과 탭 - 매체별 평균 성과 집계 및 비교 시각화
   
<br>

---
### 📈 기대 효과
- 신규 광고 매체 선택의 **데이터 기반 자동화**  
- 담당자의 **직관 의존도 감소** 및 **집행 효율 향상**  
- 장기적으로 **매체별 성과 추세 기반 예산 최적화** 가능
<br>

---
### 🧰 기술 스택
`Python`, `Pandas`, `Numpy`, `LightGBM`, `Optuna`, `Streamlit`, `Matplotlib`, `Joblib`, `Scikit-learn`, `Holidays`, `Figma(UI 디자인)`
